<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xiliulou.electricity.mapper.WithdrawRecordMapper">


	<select id="queryList" resultType="com.xiliulou.electricity.entity.WithdrawRecord">
		select twr.id as id,twr.uid as uid,twr.order_id as orderId,twr.bank_name as bankName,
		twr.bank_number as bankNumber,twr.check_time as checkTime,twr.arrive_time as arriveTime,
		twr.status as status,twr.create_time as createTime,twr.update_time as updateTime,
		twr.bank_code as bankCode,twr.true_name as trueName,twr.type as type,
		twr.amount as amount,twr.handling_fee as handlingFee,twr.msg as msg
		from t_withdraw_record as twr
		left join t_user_info as tu on tu.uid=twr.uid
		<where>
			<if test="query.uid != null ">
				and twr.uid = #{query.uid}
			</if>
			<if test="query.phone != null and query.phone != ''">
				and tu.phone = #{query.phone}
			</if>
			<if test="query.status!=null and query.status.size()>0">
				and twr.status in
				<foreach collection="query.status" item="id" index="index" open="(" close=")" separator=",">
					#{id}
				</foreach>
			</if>
			<if test="query.type != null ">
				and twr.type = #{query.type}
			</if>
			<if test="query.beginTime != null">
				and twr.create_time &gt;=#{query.beginTime}
			</if>
			<if test="query.endTime != null">
				and twr.create_time &lt;=#{query.endTime}
			</if>
			<if test="query.orderId != null">
				and twr.order_id = #{query.orderId}
			</if>
			<if test="query.tenantId != null ">
				and twr.tenant_id = #{query.tenantId}
			</if>
			<if test="query.franchiseeIds != null and query.franchiseeIds.size()>0">
				and tu.franchisee_id in
				<foreach collection="query.franchiseeIds" item="id" index="index" open="(" close=")" separator=",">
					#{id}
				</foreach>
			</if>
			<if test="query.storeIds != null and query.storeIds.size()>0">
				and tu.store_id in
				<foreach collection="query.storeIds" item="id" index="index" open="(" close=")" separator=",">
					#{id}
				</foreach>
			</if>
		</where>
		order by twr.create_time desc
		<if test="query.offset != null and query.size != null">
			limit #{query.offset}, #{query.size}
		</if>
	</select>


	<select id="queryCount" resultType="java.lang.Integer">
		select COUNT(1)
		from t_withdraw_record as twr
		left join t_user_info as tu on tu.uid=twr.uid
		<where>
			<if test="query.uid != null ">
				and twr.uid = #{query.uid}
			</if>
			<if test="query.phone != null and query.phone != ''">
				and tu.phone = #{query.phone}
			</if>
			<if test="query.status!=null and query.status.size()>0">
				and twr.status in
				<foreach collection="query.status" item="id" index="index" open="(" close=")" separator=",">
					#{id}
				</foreach>
			</if>
			<if test="query.type != null ">
				and twr.type = #{query.type}
			</if>
			<if test="query.beginTime != null">
				and twr.create_time &gt;=#{query.beginTime}
			</if>
			<if test="query.endTime != null">
				and twr.create_time &lt;=#{query.endTime}
			</if>
			<if test="query.orderId != null">
				and twr.order_id = #{query.orderId}
			</if>
			<if test="query.tenantId != null ">
				and twr.tenant_id = #{query.tenantId}
			</if>
			<if test="query.franchiseeIds != null and query.franchiseeIds.size()>0">
				and tu.franchisee_id in
				<foreach collection="query.franchiseeIds" item="id" index="index" open="(" close=")" separator=",">
					#{id}
				</foreach>
			</if>
			<if test="query.storeIds != null and query.storeIds.size()>0">
				and tu.store_id in
				<foreach collection="query.storeIds" item="id" index="index" open="(" close=")" separator=",">
					#{id}
				</foreach>
			</if>
		</where>
	</select>
	
	<update id="batchWithdrawById">
		update t_withdraw_record
		<set>
			<if test="record.status != null">
				`status` = #{record.status},
			</if>
			<if test="record.updateTime != null">
				update_time = #{record.updateTime},
			</if>
			<if test="record.checkTime != null">
				check_time = #{record.checkTime},
			</if>
			<if test="record.msg != null and record.msg != ''">
				msg = #{record.msg},
			</if>
			<if test="record.type != null">
				type = #{record.type},
			</if>
		</set>
		
		<where>
			<if test="tenantId != null">
				tenant_id = #{tenantId}
			</if>
			
			<if test="idList != null and !idList.isEmpty()">
				and id in
				<foreach collection="idList" item="id" close=")" open="(" separator=",">
					#{id}
				</foreach>
			</if>
		
		</where>
	</update>
	
	<select id="selectList" resultType="com.xiliulou.electricity.entity.WithdrawRecord">
		select twr.id as id,twr.uid as uid,twr.order_id as orderId,twr.bank_name as bankName,
		twr.bank_number as bankNumber,twr.check_time as checkTime,twr.arrive_time as arriveTime,
		twr.status as status,twr.create_time as createTime,twr.update_time as updateTime,
		twr.bank_code as bankCode,twr.true_name as trueName,twr.type as type,
		twr.amount as amount,twr.handling_fee as handlingFee,twr.msg as msg
		from t_withdraw_record as twr
		<where>
			<if test="query.tenantId != null ">
				and twr.tenant_id = #{query.tenantId}
			</if>
			<if test="query.idList != null and !query.idList.isEmpty()">
				and twr.id in
				<foreach collection="query.idList" item="id" close=")" open="(" separator=",">
					#{id}
				</foreach>
			</if>
		</where>
	</select>
	
</mapper>
