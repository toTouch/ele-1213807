<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xiliulou.electricity.mapper.FreeServiceFeeOrderMapper">


    <sql id="baseSql">
        id,
        order_id,
        free_deposit_order_id,
        uid,
        name,
        phone,
        pay_amount,
        status,
        payment_channel,
        deposit_type,
        tenant_id,
        franchisee_id,
        store_id,
        pay_time,
        create_time,
        update_time
    </sql>

    <insert id="insert">
        insert into t_free_service_fee_order
        (order_id,
         free_deposit_order_id,
         uid,
         name,
         phone,
         pay_amount,
         status,
         <if test="paymentChannel != null and paymentChannel != ''">payment_channel,</if>
         deposit_type,
         tenant_id,
         franchisee_id,
         store_id,
        <if test="payTime != null">pay_time,</if>
        create_time,
         update_time)
        values (
                #{orderId},
                #{freeDepositOrderId},
                #{uid},
                #{name},
                #{phone},
                #{payAmount},
                #{status},
                <if test="paymentChannel != null and paymentChannel != ''">  #{paymentChannel},</if>
                #{depositType},
                #{tenantId},
                #{franchiseeId},
                #{storeId},
                <if test="payTime != null">#{payTime},</if>
                #{createTime},
                #{updateTime}
        )
    </insert>


    <select id="existsPaySuccessOrder" resultType="java.lang.Integer">
        select 1
        from t_free_service_fee_order
        where free_deposit_order_id = #{freeDepositOrderId}
          and uid = #{uid}
          and status = '${@com.xiliulou.electricity.enums.FreeServiceFeeStatusEnum@STATUS_SUCCESS.status}'
    </select>

    <select id="selectPageList" resultType="com.xiliulou.electricity.entity.FreeServiceFeeOrder">
        select
        <include refid="baseSql"/>
        from t_free_service_fee_order
        where tenant_id = #{query.tenantId}
        <if test="query.orderId != null and query.orderId != ''">
            and order_id = #{query.orderId}
        </if>
        <if test="query.uid != null">
            and uid = #{query.uid}
        </if>
        <if test="query.franchiseeId != null">
            and franchisee_id = #{query.franchiseeId}
        </if>
        <if test="query.status != null">
            and status = #{query.status}
        </if>
        <if test="query.paymentChannel != null">
            and payment_channel = #{query.paymentChannel}
        </if>
        <if test="query.payStartTime != null">
            and pay_time &gt;= #{query.payStartTime}
        </if>
        <if test="query.payEndTime != null">
            and pay_time &lt;= #{query.payEndTime}
        </if>
        <if test="query.depositType != null">
            and deposit_type = #{query.depositType}
        </if>
        <if test="query.franchiseeIds != null and franchiseeIds.size() > 0 ">
            and franchisee_id in
            <foreach collection="query.franchiseeIds" item="franchiseeId" separator="or">
                #{franchiseeId}
            </foreach>
        </if>
        order by id desc
    </select>

    <select id="selectCount" resultType="java.lang.Long">
        select count(1)
        from t_free_service_fee_order
        where tenant_id = #{query.tenantId}
        <if test="query.orderId != null and query.orderId != ''">
            and order_id = #{query.orderId}
        </if>
        <if test="query.uid != null">
            and uid = #{query.uid}
        </if>
        <if test="query.franchiseeId != null">
            and franchisee_id = #{query.franchiseeId}
        </if>
        <if test="query.status != null">
            and status = #{query.status}
        </if>
        <if test="query.paymentChannel != null">
            and payment_channel = #{query.paymentChannel}
        </if>
        <if test="query.payStartTime != null">
            and pay_time &gt;= #{query.payStartTime}
        </if>
        <if test="query.payEndTime != null">
            and pay_time &lt;= #{query.payEndTime}
        </if>
        <if test="query.depositType != null">
            and deposit_type = #{query.depositType}
        </if>
        <if test="query.franchiseeIds != null and franchiseeIds.size() > 0 ">
            and franchisee_id in
            <foreach collection="query.franchiseeIds" item="franchiseeId" separator="or">
                #{franchiseeId}
            </foreach>
        </if>
    </select>
</mapper>
