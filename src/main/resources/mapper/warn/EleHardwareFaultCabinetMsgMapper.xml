<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xiliulou.electricity.mapper.warn.EleHardwareFaultCabinetMsgMapper">
    
    <insert id="batchInsert">
        insert into t_ele_hardware_fault_cabinet_msg(id , tenant_id , cabinet_id , failure_count , warn_count , create_time) values
        <foreach item="item" index="index" collection="list" separator=",">
            (#{item.id}, #{item.tenantId}, #{item.cabinetId}, #{item.failureCount}, #{item.warnCount}, #{item.createTime})
        </foreach>
    </insert>
    
    <delete id="batchDelete">
        delete
        from t_ele_hardware_fault_cabinet_msg
        WHERE create_time <![CDATA[ >= ]]>  #{startTime}
          AND create_time <![CDATA[ <= ]]>  #{endTime}
    </delete>
    
    <select id="selectListForFailure" resultType="com.xiliulou.electricity.vo.failureAlarm.FailureWarnTenantOverviewVo">
        select * from (
                          SELECT
                              tenant_id,
                              sum(failure_count) as 'failureCount'
                          FROM
                              t_ele_hardware_fault_cabinet_msg
                          where
                              create_time BETWEEN #{alarmStartTime} and #{alarmEndTime}
                            and failure_count > 0
                          GROUP BY
                              tenant_id
                      ) s
        order by s.failureCount desc
            limit #{offset}, #{size}
    </select>
    
    <select id="selectListForWarn" resultType="com.xiliulou.electricity.vo.failureAlarm.FailureWarnTenantOverviewVo">
        select * from (
                          SELECT
                              tenant_id,
                              sum(warn_count) as 'warnCount'
                          FROM
                              t_ele_hardware_fault_cabinet_msg
                          where
                              create_time BETWEEN #{alarmStartTime} and #{alarmEndTime}
                            and warn_count > 0
                          GROUP BY
                              tenant_id
                      ) s
        order by s.warnCount desc
            limit #{offset}, #{size}
    </select>
    
    <select id="countTenantOverview" resultType="java.lang.Integer">
        SELECT
        count(distinct tenant_id)
        FROM
        t_ele_hardware_fault_cabinet_msg
        WHERE
        create_time BETWEEN #{alarmStartTime} and #{alarmEndTime}
        <if test="type != null and type == 0">
            and warn_count > 0
        </if>
        <if test="type != null and type == 1">
            and failure_count > 0
        </if>
    </select>
    <select id="selectListCabinetFailure" resultType="com.xiliulou.electricity.vo.failureAlarm.FailureWarnCabinetOverviewVo">
        select s.cabinet_id,s.failureCount
        from (
            SELECT
                cabinet_id,
                sum(failure_count) as 'failureCount'
            FROM
                t_ele_hardware_fault_cabinet_msg
            where
                create_time BETWEEN #{alarmStartTime} and #{alarmEndTime}
        	and failure_count > 0
            GROUP BY cabinet_id
        ) s
        order by s.failureCount desc
            limit #{offset}, #{size}
    </select>
    <select id="selectListCabinetWarn" resultType="com.xiliulou.electricity.vo.failureAlarm.FailureWarnCabinetOverviewVo">
        select s.cabinet_id,s.warnCount
        from (
             SELECT
                 cabinet_id,
                 sum(warn_count) as 'warnCount'
             FROM
                 t_ele_hardware_fault_cabinet_msg
             where
                 create_time BETWEEN #{alarmStartTime} and #{alarmEndTime}
               and warn_count > 0
             GROUP BY cabinet_id
         ) s
        order by s.warnCount desc
            limit #{offset}, #{size}
    </select>
    
    <select id="countCabinetOverview" resultType="java.lang.Integer">
        SELECT
            count(distinct cabinet_id)
        FROM
            t_ele_hardware_fault_cabinet_msg
        where
            create_time BETWEEN #{alarmStartTime} and #{alarmEndTime}
        <if test="type != null and type == 0">
            and warn_count > 0
        </if>
        <if test="type != null and type == 1">
            and failure_count > 0
        </if>
    </select>
</mapper>
