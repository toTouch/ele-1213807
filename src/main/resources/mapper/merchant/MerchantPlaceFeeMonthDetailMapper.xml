<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xiliulou.electricity.mapper.merchant.MerchantPlaceFeeMonthDetailMapper">
    
    <insert id="batchInsert">
        insert into t_merchant_place_fee_month_detail (merchant_id ,cabinet_id ,place_id ,start_time
        ,end_time ,calculate_date ,place_fee ,tenant_id ,create_time,calculate_month ,update_time)
        values
        <foreach item="item" index="index" collection="list" separator=",">
            (#{item.merchantId}, #{item.cabinetId}, #{item.placeId}, #{item.startTime},
            #{item.endTime},#{item.calculateDate},#{item.placeFee},#{item.tenantId},#{item.createTime},#{item.calculateMonth},#{item.updateTime})
        </foreach>
    </insert>
    
    <select id="selectMerchantIdList" resultType="java.lang.Long">
        select distinct merchant_id
        from
        t_merchant_place_fee_month_detail
        <where>
            del_flag = 0
            and calculate_date <![CDATA[ >=  ]]>  #{startTime}
            and calculate_date <![CDATA[ <=  ]]>  #{endTime}
        </where>
    </select>
    <sql id="column">
        merchant_id
        ,cabinet_id ,place_id ,start_time, calculate_month
        ,end_time  ,calculate_date ,place_fee ,tenant_id  ,create_time ,update_time
    </sql>
    <select id="selectListByMerchantId"
        resultType="com.xiliulou.electricity.entity.merchant.MerchantPlaceFeeMonthDetail">
        select
        <include refid="column"/>
        from
        t_merchant_place_fee_month_detail
        <where>
            del_flag = 0
            and merchant_id = #{merchantId}
            and calculate_date <![CDATA[ >=  ]]>  #{startTime}
            and calculate_date <![CDATA[ <=  ]]>  #{endTime}
        </where>
    </select>
    <select id="selectListByMonth"
        resultType="com.xiliulou.electricity.entity.merchant.MerchantPlaceFeeMonthDetail">
        select
        <include refid="column"/>
        from
        t_merchant_place_fee_month_detail
        <where>
            calculate_month in
            <foreach collection="monthList" separator="," open="(" close=")" item="month">
                #{month}
            </foreach>
            
            <if test="placeId != null">
                and place_id = #{placeId}
            </if>
            <if test="cabinetId != null">
                and cabinet_id = #{cabinetId}
            </if>
        </where>
    </select>
</mapper>
